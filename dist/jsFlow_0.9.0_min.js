var jsFlow=function(){function t(t){if("function"!=typeof t)throw"expected function but was "+typeof t}function n(t){return"function"==typeof t.andThen&&"function"==typeof t.start&&"function"==typeof t.chill}function e(t){return!!t.map&&!!t.reduce}var i={},o={};return i.andThen=function(i,o){if(this._finalized)throw Error("flow is already finalized");var s;if(1===arguments.length&&(o=null),n(i)){var a=function(t,n){n.take(),i.start(function(t){n.pass(t)},o,t)};s=a}else if(e(i)){var f=function(t,n){n.take();var e=i.length,o=function(){return--e||n.pass()};i.forEach(function(t){jsFlow().andThen(t).start(o)})};s=f}else t(i),s=i;return this._workflow.push({func:s,context:o}),this},i.chill=function(t){if(this._finalized)throw Error("flow is already finalized");return this.andThen(function(n,e){e.take(),setTimeout(function(){e.pass(n)},t)})},i.finalize=function(){this._finalized=!0},i.start=function(t,n,e){this._finalized||(this._finalized=!0);var i=Object.create(o);if(t&&"object"==typeof t){var s=t;t=s.callback,n=s.context,e=s.initialValue}i._flow=this,i._context=n?n:null,i._callback=t?t:null,i._step=0,i._taken=!1,i.pass(e)},o.take=function(){this._taken=!0},o.pass=function(t){if(this._taken=!1,this._step<this._flow._workflow.length){var n=this._flow._workflow[this._step],e=n.context;e||(e=this._context),this._step+=1,t=n.func.call(e,t,this),this._taken||this.pass(t)}else this._callback&&this._callback.call(this._context,t)},o.revise=function(t){this._step-=1,this.pass(t)},o.drop=function(t){this._taken=!0,this._step=this._flow._workflow.length;var n=this;setTimeout(function(){n.pass(t)},1)},function(){var t=Object.create(i);return t._workflow=[],t._finalized=!1,t}}();if(JSFLOW_JWORKFLOW_API_COMPATIBLE_MODE){var jWorkflow={};jWorkflow.order=function(t,n){var e=jsFlow();return t&&e.andThen(t,n),e}}"undefined"!=typeof exports&&(exports.create=jsFlow),"object"==typeof module&&"function"==typeof require&&(module.exports=jsFlow);